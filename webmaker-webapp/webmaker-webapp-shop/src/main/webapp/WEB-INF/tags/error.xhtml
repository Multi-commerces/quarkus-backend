<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets">

<ui:composition>
	<section class="card">
		<h:form>
			<h5 class="p-mt-0">AJAX</h5>
			<p:commandButton
				action="#{exceptionHandlerView.throwViewExpiredException}"
				ajax="true" value="Throw ViewExpiredException!" styleClass="p-mr-2" />
			<p:commandButton
				action="#{exceptionHandlerView.throwNullPointerException}"
				ajax="true" value="Throw NullPointerException!" />
			<!-- IllegalStateException is not handled using ajaxExceptionHandlers below, so the error page is shown-->
			<p:commandButton
				action="#{exceptionHandlerView.throwWrappedIllegalStateException}"
				ajax="true" value="Throw IllegalStateException!" styleClass="p-mr-2" />

			<h5>Non-AJAX</h5>
			<p:commandButton
				action="#{exceptionHandlerView.throwViewExpiredException}"
				ajax="false" value="Throw ViewExpiredException!" styleClass="p-mr-2" />
			<!-- NullPointerException has no specific error-page defined in web.xml compared to ViewExpiredException -->
			<!-- https://github.com/primefaces/showcase-facelift/blob/master/src/main/webapp/WEB-INF/web.xml -->
			<p:commandButton
				action="#{exceptionHandlerView.throwNullPointerException}"
				ajax="false" value="Throw NullPointerException!" />


			<p:ajaxExceptionHandler
				type="javax.faces.application.ViewExpiredException"
				update="exceptionDialog" onexception="PF('exceptionDialog').show()" />

			<p:ajaxExceptionHandler type="java.lang.NullPointerException"
				update="exceptionDialog" onexception="PF('exceptionDialog').show()" />


			<p:dialog id="exceptionDialog"
				header="Exception '#{pfExceptionHandler.type}' occured!"
				widgetVar="exceptionDialog" height="500px">

				<h:outputText value="Message: #{pfExceptionHandler.message}"
					escape="false" />
				<br />
				<h:outputText value="StackTrace: " />
				<h:outputText value="#{pfExceptionHandler.formattedStackTrace}"
					escape="false" />
				<br />

				<p:button onclick="document.location.href = document.location.href;"
					value="Reload!"
					rendered="#{pfExceptionHandler.type == 'javax.faces.application.ViewExpiredException'}" />
			</p:dialog>


		</h:form>
	</section>
</ui:composition>

</html>